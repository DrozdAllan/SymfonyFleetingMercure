{% extends 'base.html.twig' %}

{% block title %}Chat
{% endblock %}

{% block body %}
	<div class="container">
		{% for channel in channels %}
			<h1>Channel
				{{ channel.id }}
				avec</h1>
			<div class="container" style="height: 600px">
				<div class="container bg-light h-75 overflow-auto">
					{% for message in channel.messages %}
						{% if app.user == message.user %}
							<div class="row w-75 float-right">
								<b>{{ message.user.username }}</b>
								<p class="alert alert-info w-100">
									{{ message.content }}
								</p>
							</div>
						{% else %}
							<div class="row w-75 float-left">
								<b>{{ message.user.username }}</b>
								<p class="alert alert-success w-100">
									{{ message.content }}
								</p>
							</div>
						{% endif %}
					{% endfor %}
				</div>
				<div>
					<form id="formChat" class="container row">
						<input id="message" class="input-group-text col-sm-9" placeholder="Message" type="text"/>
						<button id="submit" type="submit" class="buttonChat btn btn-success col-sm-3">Send</button>
					</form>
				</div>
			</div>
		{% endfor %}
	</div>
{% endblock %}






{% block javascripts %}
    <script>

$(document).ready(function() {

    let chatDiv = document.querySelector('.overflow-auto');
    chatDiv.scrollTop = chatDiv.scrollHeight; // On souhaite scroller toujours jusqu'au dernier message du chat

    $("#formChat").submit(function(e) {
        e.preventDefault(); // Empêche la page de se rafraîchir après le submit du formulaire
        let form = document.getElementById('formChat');
            console.log("PEDE");
            const message = document.getElementById('message'); // Récupération du message dans l'input correspondant
            const data = { // La variable data sera envoyée au controller
                'content': message.value, // On transmet le message...
                'channel': '1' // ... Et le canal correspondant A CHANGER
            }
            console.log(data); // Pour vérifier vos informations
            fetch('/message', { // On envoie avec un post nos datas sur le endpoint /message de notre application
                method: 'POST',
                body: JSON.stringify(data) // On envoie les data sous format JSON
            }).then((response) => {
                message.value = '';
                console.log(response);
            });  
    });

});

    </script>
{% endblock %}